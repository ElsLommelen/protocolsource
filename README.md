# protocols

INBO protocols for monitoring

*experimental*: we are in the process of trying out git-version control for INBO protocols. In the meantime, the official versions of INBO protocols are hosted [here](https://sites.google.com/a/inbo.be/veldprotocols/) (only accessible to INBO collaborators). Developmental versions are at [this google drive folder](https://drive.google.com/drive/folders/0BzUqT1wpznBXY2ZqaXh2a0tyd2M) (only accessible to INBO collaborators). 

## Repository structure

```
  |- README.md <- up to date description of the repo content
  |- docs <- contains rendered versions of protocols
  |- from_docx <- contains docx protocols which were converted to markdown
  |- src
  |    |- thematic 
  |    |   |- 0_generic
  |    |   |- 1_water 
  |    |   |- 2_air 
  |    |   |- 3_soil 
  |    |   |- 4_vegetation 
  |    |   |- 5_species
  |    |- project <- project-specific protocols
  |    |- utils
```



## Protocols written in Rmarkdown

Some useful resources for self-learning of **Rmarkdown**:

[tutorial rmarkdown](https://ourcodingclub.github.io/2016/11/24/rmarkdown-1.html)

In RStudio: 

* `File -> New -> R markdown` automatically gives a template 
* `Help -> Markdown Quick Reference`
* `Help -> Cheatsheets -> R markdown cheatsheet`


Tips & Tricks:

* `ctrl + alt + i`: insert R chunk 
* select lines of R code in an R chunk followed by `ctrl-alt-i` puts the selected lines in a new R chunk
* chunk options: https://yihui.name/knitr/options/
* chunk names: are optional but recommended especially if an output is generated by the chunk, do not use spaces or _ in chunk names (e.g. ```r name-of-chunk)
* use 1 chunk for 1 (ggplot) figure or 1 table or other type of output that is printed 

## Starting a new protocol

### From an existing docx protocol

```r
library(protocolhelper)
create_sfp(title = "Klassieke vegetatieopname in een proefvlak aan de hand van visuele inschattingen van bedekking van soorten in (semi-)terrestrische vegetatie",
           subtitle = "", 
           short_title = "vegopname terrest",
           authors = "Els De Bie", 
           date = "2016-07-19", 
           reviewers = "Hans Van Calster, Lieve Vriens, Jan Wouters, Wouter Van Gompel, Els Lommelen", 
           file_manager = "Hans Van Calster", 
           revision = "1.1.0.9000",
           theme = "vegetation",
           language = "nl",
           from_docx = 
             file.path(path_to_from_docx, 
                       "SVP_401_VegetatieOpnamePV_Terrestrisch_v1.1.docx"),
           protocol_number = "401", 
           render = TRUE)
```



### From a new template


```r
library(protocolhelper)
create_sfp(title = "titel van het protocol",
           subtitle = "optionele subtitel", 
           short_title = "korte titel",
           authors = "Voornaam Naam", 
           date = "`r Sys.Date()`", 
           reviewers = "Voornaam Naam, ...", 
           file_manager = "Voornaam Naam", 
           revision = "0.0.0.9000",
           theme = "vegetation",
           language = "nl",
           from_docx = NULL,
           protocol_number = NULL, 
           render = TRUE)
```



## How to contribute?


### Suggesting changes to existing protocols

#### Using online editing functionalities

To do: write this section


#### Using RStudio and git version control

Installing the repository on your local drive:

* go to the repository https://github.com/inbo/protocols/ and press clone button
* copy the URL to the clipboard
* start RStudio and select `File -> New project -> Version Control -> Git` -> paste the URL
* `protocols` will be automatically suggested as project directory name (keep it that way)
* In the field `Create project as subdirectory of` select a folder on your local disc (do *not* use a folder that google drive file stream synchronizes). For instance `C:/R/GitRepositories`.
* Click OK

You will now have a local clone of the remote repository as an RStudio project. The file `protocols.Rproj` will be automatically created as well as a `.git` directory (do not make changes in this directory - it is where version control takes place). 
The same directories and files which can be seen on the remote (https://github.com/inbo/protocols) will be copied to your local drive. 
Whenever you want to work in the project, you need to double-click `protocols.Rproj` file to start the RStudio project. 

To refer to files use the `rprojroot` package. Here is an example to refer to the utils folder:

```r
library(rprojroot)
path_to_utils <- file.path(
  find_root(is_git_root),
  "src",
  "utils"
  )
```


*Branching model:*

```
  |- master branch <- contains only finished and approved protocols, both source code and html rendered github pages
      | - develop branch <- contains development versions of protocols, this is the default branch
          | - other, preferably short-lived branches which contain work in progress on a specific protocol
```

* We work with a simple branching model
    * one branch to work on one `Rmd` file
    * shortlived branches
    * For support on the workflow, we advise you to follow [this workflow](https://inbo.github.io/git-course/workflow_rstudio.html).
* The workflow in short:
    * Merging a branch to the master will be done through a pull request (PR)
        * To do this go to https://github.com/inbo/protocols and click on `New pull request` for the branch you want to merge
        * The one who made the PR, will assign one or more reviewers
        * When approved the PR can be merged


### Starting a new protocol

The file `src/utils/maak_protocol.R` contains functions to aid the development of a new protocol. The function will write a template Rmarkdown file to a folder. The name and location of the file and folder will be automatically determined by means of the input that you provide to the arguments of the function. Some examples can be seen in the file `src/utils/setup_pre-existing_folders.R`

After these folders are created, you can start working in the Rmarkdown file following the instructions given [in this section](#using-rstudio-and-git-version-control).


### Update NEWS.md


Add instructions how to update NEWS.md files.
